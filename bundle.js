(()=>{"use strict";(()=>{function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var r,o,i=[],a=!0,c=!1;try{for(e=e.call(t);!(a=(r=e.next()).done)&&(i.push(r.value),!n||i.length!==n);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==e.return||e.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}var e=function(n,e){var r=t(n,2),o=r[0],i=r[1];return{block:"td",cls:"td__".concat(o),content:i,attrs:{id:e}}},r=function(t){return{block:"tr",cls:"table__row",content:Object.entries(t).map(e)}};var o=function(t){return{title:t.title,cost:t.cost,actions:{block:"div",cls:"actions__container",content:[{block:"div",cls:"table__button button__delete"},{block:"div",cls:"table__button button__edit"}]}}};function i(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var r,o,i=[],a=!0,c=!1;try{for(e=e.call(t);!(a=(r=e.next()).done)&&(i.push(r.value),!n||i.length!==n);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==e.return||e.return()}finally{if(c)throw o}}return i}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return a(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return a(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function c(t){if(!t)return"";if("string"==typeof t)return t;if(Array.isArray(t)){var n="";return t.forEach((function(t){var e=c(t);n+=e})),n}var e=t.block,r=t.cls,o=t.content,a=t.attrs,u="",l="";return a&&Object.entries(a).forEach((function(t){var n=i(t,2),e=n[0],r=n[1];u+="novalidate"===e||"required"===e?"".concat(e," "):"".concat(e,'="').concat(r,'"')})),r&&(l='class="'.concat(r,'"')),function(t,n,e,r){return"input"===t||"img"===t?"<".concat(t," ").concat(r).concat(n,">"):"<".concat(t," ").concat(r).concat(n,">").concat(e,"</").concat(t,">")}(e,l,c(o),u)}var u=function(t){return{block:"div",cls:"row row__".concat(t.param),content:[{block:"span",cls:"title title__".concat(t.param),content:t.title},{block:"input",cls:"input input__".concat(t.param),attrs:{required:!0,name:t.name,pattern:t.pattern}}]}},l=function(t,n,e){return{block:"button",cls:"controls__button ".concat(t,"-button"),content:n,attrs:{type:e}}},s={block:"div",cls:"controls",content:[l("save","Сохранить","submit"),l("cancel","Отмена","button")]};const f={block:"form",cls:"form form__active",content:[[{param:"name",title:"Название",name:"title",type:"text",pattern:".+"},{param:"cost",title:"Цена",name:"cost",type:"text",pattern:"[0-9]+"}].map(u),s],attrs:{novalidate:!0}};const d={title:{valueMissing:"Введите название товара"},cost:{valueMissing:"Введите стоимость",patternMismatch:"В этом поле должны быть только цифры"}};function h(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var y=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.node=n,this.coords=this.node.getBoundingClientRect()}var n,e,r;return n=t,(e=[{key:"showError",value:function(t){this.hideError();var n=document.createElement("div");n.className="tooltip form-error",n.textContent=t,document.body.appendChild(n),this.position(n),setTimeout((function(){return n.remove()}),5e3),this.tooltip=n}},{key:"position",value:function(t){var n="".concat(this.coords.top+this.coords.height/2-t.offsetHeight/2+window.scrollY,"px");t.style.top=n,t.style.left="".concat(this.coords.right+10+window.scrollX,"px")}},{key:"hideError",value:function(){this.tooltip&&this.tooltip.remove()}},{key:"clearField",value:function(){this.node.value=""}}])&&h(n.prototype,e),r&&h(n,r),t}();function m(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var r,o,i=[],a=!0,c=!1;try{for(e=e.call(t);!(a=(r=e.next()).done)&&(i.push(r.value),!n||i.length!==n);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==e.return||e.return()}finally{if(c)throw o}}return i}(t,n)||b(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||b(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,n){if(t){if("string"==typeof t)return p(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?p(t,n):void 0}}function p(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function g(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var w=function(){function t(n){var e=this;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=document.body,this.render(),this.position(n),this.init(),this.hide(),this.node.addEventListener("input",(function(t){return e.onInput(t)})),this.cancelButton=this.node.querySelector(".cancel-button"),this.cancelButton.addEventListener("click",(function(){return e.hide()}))}var n,e,r;return n=t,(e=[{key:"render",value:function(){var t=c(f);this.container.insertAdjacentHTML("beforeend",t),this.node=this.container.querySelector(".form")}},{key:"position",value:function(t){var n=t.getBoundingClientRect();this.node.style.left="".concat(n.left-10,"px"),this.node.style.top="".concat(n.top-110,"px")}},{key:"init",value:function(){this.formElems=v(this.node.elements).map((function(t){return new y(t)}))}},{key:"show",value:function(t){var n=this;this.node.classList.add("form__active"),t&&Object.entries(t).forEach((function(t){var e=m(t,2),r=e[0],o=e[1];n.formElems.find((function(t){return t.node.name===r})).node.value=o}))}},{key:"clearFields",value:function(){this.formElems.forEach((function(t){return t.clearField()}))}},{key:"hide",value:function(){this.node.classList.remove("form__active")}},{key:"checkSubmit",value:function(t){var n=this;return t.preventDefault(),this.node.checkValidity()?(this.hide(),!0):(this.formElems.forEach((function(t){var e=t.node;if(!e.validity.valid){var r=n.getInputError(e);t.showError(r)}})),!1)}},{key:"getInputError",value:function(t){var n=Object.keys(ValidityState.prototype).find((function(n){return t.validity[n]}));return d[t.name][n]}},{key:"clearErrors",value:function(){this.formElems.forEach((function(t){return t.hideError()}))}},{key:"onInput",value:function(t){var n=t.target,e=this.findFormElem(n),r=this.getInputError(n);return r?(e.showError(r),!0):(e.hideError(),!1)}},{key:"findFormElem",value:function(t){return this.formElems.find((function(n){return n.node.name===t.name}))}},{key:"getFormData",value:function(){return this.formElems.reduce((function(t,n){var e=n.node;return t[e.name]=e.value,t}),{})}}])&&g(n.prototype,e),r&&g(n,r),t}();function E(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var r,o,i=[],a=!0,c=!1;try{for(e=e.call(t);!(a=(r=e.next()).done)&&(i.push(r.value),!n||i.length!==n);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==e.return||e.return()}finally{if(c)throw o}}return i}(t,n)||S(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||S(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,n){if(t){if("string"==typeof t)return _(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_(t,n):void 0}}function _(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function A(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var j=function(){function t(){var n=this;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=document.querySelector("tbody"),this.form=new w(this.container),this.form.node.addEventListener("submit",(function(t){return n.onFormSubmit(t)})),this.addButton=document.querySelector(".plus-sign"),this.addButton.addEventListener("click",(function(){return n.form.show()})),this.container.addEventListener("click",(function(t){return n.onEdit(t)})),this.container.addEventListener("click",(function(n){return t.onRemove(n)})),window.addEventListener("beforeunload",(function(){return n.onWindowClose()}))}var n,e,i;return n=t,i=[{key:"onRemove",value:function(t){t.target.classList.contains("button__delete")&&t.target.closest(".table__row").remove()}},{key:"getNoteData",value:function(t){return k(t.children).reduce((function(t,n){var e=n.className.substring(4),r=n.textContent;return"actions"!==e&&(t[e]=r),t}),{})}}],(e=[{key:"render",value:function(t){var n=c(function(t){return{block:"table",cls:"table",content:t.map(r)}}(t));this.container.innerHTML=n,this.notes=k(this.container.children)}},{key:"onFormSubmit",value:function(t){if(this.form.clearErrors(),this.form.checkSubmit(t)){var n=this.form.getFormData();if(this.edited)return k(this.edited.children).forEach((function(t){var e=t.className.substring(4);Object.entries(n).forEach((function(n){var r=E(n,2),o=r[0],i=r[1];o===e&&(t.textContent=i)}))})),void(this.edited=null);var e=o(n),i=c(r(e));this.container.insertAdjacentHTML("beforeend",i),this.form.clearFields()}}},{key:"onEdit",value:function(n){if(n.target.classList.contains("button__edit")){var e=n.target.closest(".table__row");this.edited=e;var r=t.getNoteData(e);this.form.show(r)}}}])&&A(n.prototype,e),i&&A(n,i),t}();const I=JSON.parse('[{"title":"iPhone XR","cost":"60000","id":"1"},{"title":"Samsung Galaxy S10+","cost":"80000","id":"2"},{"title":"Huawei View","cost":"50000","id":"3"}]');new function t(){var n=this;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),window.onload=function(){n.table=new j;var t,e=(t=I,Object.values(t).map(o));n.table.render(e)}}})()})();
//# sourceMappingURL=bundle.js.map